#:import Window kivy.core.window.Window

<Window>:
    canvas.before:
        Color:
            rgba: (0.1, 0.1, 0.1, 1)
        Rectangle:
            pos: self.pos
            size: self.size

<RoundedButton@Button>:
    background_normal: ""
    background_down: ""
    background_color: self.background_color
    color: 1, 1, 1, 1
    font_size: "18sp"
    canvas.before:
        Color:
            rgba: self.background_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [20]

<NumericButton@RoundedButton>:
    font_size: "20sp"
    size_hint: None, None
    size: "70dp", "70dp"
    background_color: 0.2, 0.2, 0.2, 1
    color: 1, 1, 1, 1

<Card@BoxLayout>:
    size_hint_y: None
    height: self.minimum_height
    padding: 10
    spacing: 5
    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10]

ScreenManager:
    HomeScreen:
    DataEntryScreen:
    MeasurementInputScreen:
    ViewDataScreen:
    PlotScreen:
    StatsScreen:
    SleepInputScreen:

<HomeScreen>:
    name: "home"
    BoxLayout:
        orientation: "vertical"
        spacing: 15
        padding: [30,50,30,50]

        Label:
            text: "Pain Logger"
            font_size: "32sp"
            bold: True
            size_hint_y: None
            height: "60dp"
            color: 0.9, 0.9, 0.9, 1

        RoundedButton:
            text: "Enter Measurement"
            background_color: app.modern_palette(0,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "data_entry"

        RoundedButton:
            text: "Log Sleep"
            background_color: app.modern_palette(1,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "sleep_input"

        RoundedButton:
            text: "View Data"
            background_color: app.modern_palette(2,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "view_data"

        RoundedButton:
            text: "Plot Data"
            background_color: app.modern_palette(3,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "plot_screen"

        RoundedButton:
            text: "View Stats"
            background_color: app.modern_palette(4,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "stats_screen"

        RoundedButton:
            text: "Export CSV"
            background_color: app.modern_palette(5,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.export_csv()

        RoundedButton:
            text: "Delete All Data"
            background_color: app.modern_palette(6,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.show_delete_confirmation()

<DataEntryScreen>:
    name: "data_entry"
    BoxLayout:
        orientation: "vertical"
        spacing: 15
        padding: 20

        Label:
            text: "Select Body Section"
            font_size: "24sp"
            size_hint_y: None
            height: "50dp"

        GridLayout:
            cols: 3
            spacing: 10

            RoundedButton:
                text: "Left Upper"
                background_color: app.modern_palette(0,6)
                on_press: root.open_input_screen("LU")

            RoundedButton:
                text: "Head"
                background_color: app.modern_palette(1,6)
                on_press: root.open_input_screen("Head")

            RoundedButton:
                text: "Right Upper"
                background_color: app.modern_palette(2,6)
                on_press: root.open_input_screen("RU")

            RoundedButton:
                text: "Left Lower"
                background_color: app.modern_palette(3,6)
                on_press: root.open_input_screen("LL")

            RoundedButton:
                text: "Axial"
                background_color: app.modern_palette(4,6)
                on_press: root.open_input_screen("Axial")

            RoundedButton:
                text: "Right Lower"
                background_color: app.modern_palette(5,6)
                on_press: root.open_input_screen("RL")

        RoundedButton:
            text: "Back"
            background_color: app.modern_palette(6,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "home"

<MeasurementInputScreen>:
    name: "input_screen"
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 20

        Label:
            id: section_label
            text: "Enter measurement"
            font_size: "24sp"
            size_hint_y: None
            height: "50dp"

        Label:
            id: display_value
            text: ""
            font_size: "36sp"
            halign: "center"
            size_hint_y: None
            height: "60dp"

        GridLayout:
            cols: 3
            spacing: 10
            size_hint_y: None
            height: self.minimum_height

            NumericButton:
                text: "1"
                on_press: root.append_number("1")
            NumericButton:
                text: "2"
                on_press: root.append_number("2")
            NumericButton:
                text: "3"
                on_press: root.append_number("3")
            NumericButton:
                text: "4"
                on_press: root.append_number("4")
            NumericButton:
                text: "5"
                on_press: root.append_number("5")
            NumericButton:
                text: "6"
                on_press: root.append_number("6")
            NumericButton:
                text: "7"
                on_press: root.append_number("7")
            NumericButton:
                text: "8"
                on_press: root.append_number("8")
            NumericButton:
                text: "9"
                on_press: root.append_number("9")
            NumericButton:
                text: "."
                on_press: root.append_number(".")
            NumericButton:
                text: "0"
                on_press: root.append_number("0")
            NumericButton:
                text: "⌫"
                on_press: root.delete_last()

        Label:
            id: status_label
            text: ""
            color: 1,0,0,1
            font_size: "14sp"

        RoundedButton:
            text: "Save and Return"
            size_hint_y: None
            height: "50dp"
            background_color: app.modern_palette(1, 7)
            on_press: root.save_and_return()

<ViewDataScreen>:
    name: "view_data"
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 15

        Label:
            text: "Saved Data"
            font_size: "26sp"
            size_hint_y: None
            height: "50dp"

        ScrollView:
            GridLayout:
                id: data_table
                cols: 1
                spacing: 10
                padding: 10
                size_hint_y: None
                height: self.minimum_height

        RoundedButton:
            text: "Back"
            background_color: app.modern_palette(0,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "home"

<PlotScreen>:
    name: "plot_screen"
    BoxLayout:
        orientation: "vertical"
        spacing: 15
        padding: 20

        Label:
            text: "Pain Over Time"
            font_size: "26sp"
            size_hint_y: None
            height: "50dp"

        BoxLayout:
            id: plot_container
            padding: 10
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [15]

        RoundedButton:
            text: "Back"
            background_color: app.modern_palette(0,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "home"

<StatsScreen>:
    name: "stats_screen"
    BoxLayout:
        orientation: "vertical"
        spacing: 15
        padding: 20

        Label:
            text: "Statistics Summary"
            font_size: "26sp"
            size_hint_y: None
            height: "50dp"

        ScrollView:
            BoxLayout:
                id: stats_box
                orientation: "vertical"
                spacing: 10
                size_hint_y: None
                height: self.minimum_height
                padding: 10

        RoundedButton:
            text: "Back"
            background_color: app.modern_palette(0,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "home"

<SleepInputScreen>:
    name: "sleep_input"
    BoxLayout:
        orientation: "vertical"
        spacing: 15
        padding: 20

        Label:
            text: "Log Sleep"
            font_size: "26sp"
            size_hint_y: None
            height: "50dp"

        TextInput:
            id: hours_input
            hint_text: "Hours Slept"
            input_filter: "float"
            multiline: False
            size_hint_y: None
            height: "50dp"
            background_color: 0.2, 0.2, 0.2, 1
            foreground_color: 1, 1, 1, 1
            cursor_color: 1, 1, 1, 1
            padding: 10

        Label:
            text: "Sleep Quality (1–3)"
            font_size: "20sp"
            size_hint_y: None
            height: "40dp"

        BoxLayout:
            spacing: 10
            size_hint_y: None
            height: "50dp"

            RoundedButton:
                text: "1"
                background_color: app.modern_palette(2,7)
                on_press: root.set_quality("1")

            RoundedButton:
                text: "2"
                background_color: app.modern_palette(3,7)
                on_press: root.set_quality("2")

            RoundedButton:
                text: "3"
                background_color: app.modern_palette(4,7)
                on_press: root.set_quality("3")

        Label:
            id: quality_label
            text: "Quality selected: None"
            font_size: "16sp"
            size_hint_y: None
            height: "30dp"
            color: 0.8, 0.8, 0.8, 1

        RoundedButton:
            text: "Save and Return"
            size_hint_y: None
            height: "50dp"
            background_color: app.modern_palette(1,7)
            on_press: root.save_sleep_data()

        RoundedButton:
            text: "Back"
            background_color: app.modern_palette(0,7)
            size_hint_y: None
            height: "50dp"
            on_press: app.root.current = "home"
